## ìš”ì•½

Moonwave êµ¬ë…ê´€ë¦¬ ì‹œìŠ¤í…œ v2.0ì˜ ê¸°ìˆ  ì•„í‚¤í…ì²˜ ë¬¸ì„œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. React + TypeScript + Vite ê¸°ë°˜ì˜ ì •ì  SPAì™€ Supabase BaaSë¥¼ í™œìš©í•œ ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì²˜ë¡œ êµ¬ì„±ë˜ë©°, GitHub Pagesë¥¼ í†µí•œ ìë™ ë°°í¬ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•©ë‹ˆë‹¤.

## ë¶„ì„

í”„ë¡œì íŠ¸ ë¬¸ì„œë“¤ì„ í†µí•´ íŒŒì•…í•œ í•µì‹¬ ê¸°ìˆ  ìš”ì†Œ:
- **í”„ë¡ íŠ¸ì—”ë“œ**: React + TypeScript + Vite + Tailwind CSS
- **ë°±ì—”ë“œ**: Supabase (PostgreSQL + Auth + Storage)
- **ë°°í¬**: GitHub Actions â†’ GitHub Pages
- **ë””ìì¸ ì‹œìŠ¤í…œ**: Utility-First CSS, Container Queries, Pretendard í°íŠ¸
- **ë°ì´í„° êµ¬ì¡°**: ìœ ì €ë³„ ì™„ì „ ë¶„ë¦¬ëœ êµ¬ë… ê´€ë¦¬ ì‹œìŠ¤í…œ

## ì‹¤í–‰

# ğŸ—ï¸ Moonwave ê¸°ìˆ  ì•„í‚¤í…ì²˜ v2.0

## 1. ì‹œìŠ¤í…œ ê°œìš”

### 1.1 ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```mermaid
graph TB
    subgraph "Client Layer"
        A[React SPA<br/>TypeScript + Vite]
        B[Tailwind CSS<br/>+ Container Queries]
    end
    
    subgraph "Authentication"
        C[Supabase Auth<br/>Email + OAuth]
    end
    
    subgraph "Backend Services"
        D[Supabase Database<br/>PostgreSQL]
        E[Supabase Storage<br/>File Storage]
        F[Supabase Realtime<br/>WebSocket]
    end
    
    subgraph "Deployment"
        G[GitHub Actions<br/>CI/CD Pipeline]
        H[GitHub Pages<br/>Static Hosting]
    end
    
    A --> C
    A --> D
    A --> E
    A --> F
    A --> G
    G --> H
```

### 1.2 í•µì‹¬ ì›ì¹™

| ì›ì¹™ | ì„¤ëª… |
|------|------|
| **Serverless First** | ì„œë²„ ê´€ë¦¬ ì—†ëŠ” BaaS í™œìš© |
| **Static Deployment** | ì •ì  ë°°í¬ë¡œ ë¹„ìš© íš¨ìœ¨ì„± ê·¹ëŒ€í™” |
| **Type Safety** | TypeScriptë¡œ ì „ì²´ íƒ€ì… ì•ˆì „ì„± ë³´ì¥ |
| **Utility-First CSS** | Tailwind CSSë¡œ ì¼ê´€ëœ ë””ìì¸ ì‹œìŠ¤í…œ |
| **User Isolation** | ìœ ì €ë³„ ë°ì´í„° ì™„ì „ ë¶„ë¦¬ |

---

## 2. ê¸°ìˆ  ìŠ¤íƒ

### 2.1 í”„ë¡ íŠ¸ì—”ë“œ ìŠ¤íƒ

```typescript
// package.json í•µì‹¬ ì˜ì¡´ì„±
{
  "dependencies": {
    "react": "^18.2.0",
    "@supabase/supabase-js": "^2.39.0",
    "clsx": "^2.1.0",
    "tailwind-merge": "^2.2.0",
    "@radix-ui/react-icons": "^1.3.0",
    "lucide-react": "^0.303.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.43",
    "@vitejs/plugin-react": "^4.2.1",
    "typescript": "^5.2.2",
    "vite": "^5.0.8",
    "tailwindcss": "^3.3.0",
    "@tailwindcss/container-queries": "^0.1.1"
  }
}
```

### 2.2 ë°±ì—”ë“œ ìŠ¤íƒ (Supabase)

| ì„œë¹„ìŠ¤ | ìš©ë„ | íŠ¹ì§• |
|--------|------|------|
| **PostgreSQL** | ë©”ì¸ ë°ì´í„°ë² ì´ìŠ¤ | RLS ì •ì±…ìœ¼ë¡œ ë³´ì•ˆ ê°•í™” |
| **Auth** | ì¸ì¦ ì„œë¹„ìŠ¤ | Email/Password + Google OAuth |
| **Storage** | íŒŒì¼ ì €ì¥ì†Œ | ì„œë¹„ìŠ¤ ë¡œê³ /ì´ë¯¸ì§€ ì €ì¥ |
| **Realtime** | ì‹¤ì‹œê°„ ë™ê¸°í™” | êµ¬ë… ìƒíƒœ ë³€ê²½ ê°ì§€ |
| **Edge Functions** | ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜ | ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (ì„ íƒ) |

---

## 3. í”„ë¡ íŠ¸ì—”ë“œ ì•„í‚¤í…ì²˜

### 3.1 ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                    # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ UI ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”œâ”€â”€ Card.tsx
â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â””â”€â”€ Modal.tsx
â”‚   â”œâ”€â”€ layout/                # ë ˆì´ì•„ì›ƒ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”œâ”€â”€ Footer.tsx
â”‚   â”‚   â””â”€â”€ MusicPlayer.tsx
â”‚   â””â”€â”€ features/              # ê¸°ëŠ¥ë³„ ì»´í¬ë„ŒíŠ¸
â”‚       â”œâ”€â”€ subscription/
â”‚       â”‚   â”œâ”€â”€ SubscriptionCard.tsx
â”‚       â”‚   â”œâ”€â”€ SubscriptionList.tsx
â”‚       â”‚   â””â”€â”€ SubscriptionForm.tsx
â”‚       â”œâ”€â”€ calendar/
â”‚       â”‚   â””â”€â”€ PaymentCalendar.tsx
â”‚       â””â”€â”€ dashboard/
â”‚           â””â”€â”€ DashboardStats.tsx
```

### 3.2 ìƒíƒœ ê´€ë¦¬ ì „ëµ

```typescript
// Context APIë¥¼ í™œìš©í•œ ì „ì—­ ìƒíƒœ ê´€ë¦¬
// src/contexts/AppContext.tsx
interface AppState {
  user: User | null;
  subscriptions: Subscription[];
  exchangeRate: ExchangeRate;
  loading: boolean;
}

const AppContext = createContext<AppState | null>(null);

// Custom Hooksë¥¼ í†µí•œ ìƒíƒœ ì ‘ê·¼
export const useSubscriptions = () => {
  const context = useContext(AppContext);
  if (!context) throw new Error('useSubscriptions must be used within AppProvider');
  return context.subscriptions;
};
```

### 3.3 ë¼ìš°íŒ… êµ¬ì¡°

```typescript
// src/App.tsx
const App = () => {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Layout />}>
          <Route index element={<Home />} />
          <Route path="dashboard" element={<ProtectedRoute><Dashboard /></ProtectedRoute>} />
          <Route path="subscriptions" element={<ProtectedRoute><Subscriptions /></ProtectedRoute>} />
          <Route path="calendar" element={<ProtectedRoute><Calendar /></ProtectedRoute>} />
          <Route path="auth" element={<Auth />} />
        </Route>
      </Routes>
    </BrowserRouter>
  );
};
```

---

## 4. ë°±ì—”ë“œ ì•„í‚¤í…ì²˜ (Supabase)

### 4.1 ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

```sql
-- ìœ ì € í…Œì´ë¸” (Supabase Auth ì œê³µ)
-- auth.users

-- êµ¬ë… í…Œì´ë¸”
CREATE TABLE subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  service_name TEXT NOT NULL,
  service_url TEXT,
  service_image_url TEXT,
  category TEXT[],
  status TEXT CHECK (status IN ('active', 'paused', 'canceled')),
  amount NUMERIC NOT NULL,
  currency TEXT CHECK (currency IN ('KRW', 'USD')),
  payment_cycle TEXT CHECK (payment_cycle IN ('monthly', 'yearly', 'once')),
  payment_day INTEGER CHECK (payment_day >= 1 AND payment_day <= 31),
  payment_method TEXT,
  start_date DATE,
  end_date DATE,
  auto_renewal BOOLEAN DEFAULT true,
  alarm_days INTEGER[],
  tier TEXT,
  benefits TEXT,
  tags TEXT[],
  memo TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- í™˜ìœ¨ í…Œì´ë¸”
CREATE TABLE exchange_rates (
  user_id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  usd_krw NUMERIC DEFAULT 1300,
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ì•ŒëŒ í…Œì´ë¸”
CREATE TABLE subscription_alarms (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  subscription_id UUID REFERENCES subscriptions(id) ON DELETE CASCADE,
  alarm_type TEXT NOT NULL,
  alarm_day INTEGER,
  alarm_time TIME,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 4.2 Row Level Security (RLS)

```sql
-- êµ¬ë… í…Œì´ë¸” RLS
ALTER TABLE subscriptions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can only see their own subscriptions" ON subscriptions
  FOR ALL USING (auth.uid() = user_id);

-- í™˜ìœ¨ í…Œì´ë¸” RLS
ALTER TABLE exchange_rates ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can only manage their own exchange rate" ON exchange_rates
  FOR ALL USING (auth.uid() = user_id);

-- ì•ŒëŒ í…Œì´ë¸” RLS
ALTER TABLE subscription_alarms ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can only manage their own alarms" ON subscription_alarms
  FOR ALL USING (auth.uid() = user_id);
```

### 4.3 Supabase í´ë¼ì´ì–¸íŠ¸ ì„¤ì •

```typescript
// src/lib/supabase.ts
import { createClient } from '@supabase/supabase-js';
import type { Database } from './database.types';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

export const supabase = createClient<Database>(supabaseUrl, supabaseAnonKey, {
  auth: {
    persistSession: true,
    autoRefreshToken: true,
    detectSessionInUrl: true
  }
});

// íƒ€ì… ì•ˆì „ í—¬í¼ í•¨ìˆ˜
export const getSubscriptions = async (userId: string) => {
  const { data, error } = await supabase
    .from('subscriptions')
    .select('*')
    .eq('user_id', userId)
    .order('payment_day', { ascending: true });
    
  if (error) throw error;
  return data;
};
```

---

## 5. ì¸ì¦ ì‹œìŠ¤í…œ

### 5.1 ì¸ì¦ í”Œë¡œìš°

```mermaid
sequenceDiagram
    participant User
    participant React App
    participant Supabase Auth
    participant Database
    
    User->>React App: ë¡œê·¸ì¸ ì‹œë„
    React App->>Supabase Auth: ì¸ì¦ ìš”ì²­
    Supabase Auth-->>React App: JWT í† í°
    React App->>React App: í† í° ì €ì¥
    React App->>Database: ì¸ì¦ëœ API ìš”ì²­
    Database-->>React App: ìœ ì € ë°ì´í„°
    React App-->>User: ëŒ€ì‹œë³´ë“œ í‘œì‹œ
```

### 5.2 ì¸ì¦ êµ¬í˜„

```typescript
// src/hooks/useAuth.ts
export const useAuth = () => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // ì„¸ì…˜ ì²´í¬
    supabase.auth.getSession().then(({ data: { session } }) => {
      setUser(session?.user ?? null);
      setLoading(false);
    });

    // ì¸ì¦ ìƒíƒœ ë³€ê²½ ê°ì§€
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (_event, session) => {
        setUser(session?.user ?? null);
      }
    );

    return () => subscription.unsubscribe();
  }, []);

  const signIn = async (email: string, password: string) => {
    const { data, error } = await supabase.auth.signInWithPassword({
      email,
      password,
    });
    if (error) throw error;
    return data;
  };

  const signInWithGoogle = async () => {
    const { data, error } = await supabase.auth.signInWithOAuth({
      provider: 'google',
      options: {
        redirectTo: `${window.location.origin}/dashboard`
      }
    });
    if (error) throw error;
    return data;
  };

  return { user, loading, signIn, signInWithGoogle, signOut };
};
```

---

## 6. ë°°í¬ ì•„í‚¤í…ì²˜

### 6.1 CI/CD íŒŒì´í”„ë¼ì¸

```yaml
# .github/workflows/deploy.yml
name: Deploy to GitHub Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Type check
        run: npm run type-check
        
      - name: Lint
        run: npm run lint
        
      - name: Build
        run: npm run build
        env:
          VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL }}
          VITE_SUPABASE_ANON_KEY: ${{ secrets.VITE_SUPABASE_ANON_KEY }}
          
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './dist'
          
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

### 6.2 í™˜ê²½ ì„¤ì •

```typescript
// vite.config.ts
import { defineConfig, loadEnv } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, process.cwd(), '');
  
  return {
    plugins: [react()],
    resolve: {
      alias: {
        '@': path.resolve(__dirname, './src'),
      },
    },
    base: mode === 'production' ? '/moonwave/' : '/',
    build: {
      outDir: 'dist',
      sourcemap: mode === 'development',
      rollupOptions: {
        output: {
          manualChunks: {
            'react-vendor': ['react', 'react-dom'],
            'supabase-vendor': ['@supabase/supabase-js'],
          },
        },
      },
    },
    server: {
      port: 5173,
      host: true,
    },
  };
});
```

---

## 7. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 7.1 ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] **RLS ì •ì±…**: ëª¨ë“  í…Œì´ë¸”ì— Row Level Security ì ìš©
- [ ] **í™˜ê²½ ë³€ìˆ˜**: ë¯¼ê°í•œ ì •ë³´ëŠ” í™˜ê²½ ë³€ìˆ˜ë¡œ ê´€ë¦¬
- [ ] **HTTPS ì „ìš©**: GitHub Pages ê¸°ë³¸ HTTPS ì§€ì›
- [ ] **CSP í—¤ë”**: Content Security Policy ì„¤ì •
- [ ] **ì…ë ¥ ê²€ì¦**: í´ë¼ì´ì–¸íŠ¸/ì„œë²„ ëª¨ë‘ì—ì„œ ê²€ì¦
- [ ] **SQL Injection ë°©ì§€**: Prepared statements ì‚¬ìš© (Supabase ê¸°ë³¸)
- [ ] **XSS ë°©ì§€**: React ê¸°ë³¸ ì´ìŠ¤ì¼€ì´í•‘ í™œìš©

### 7.2 ë³´ì•ˆ êµ¬í˜„ ì˜ˆì‹œ

```typescript
// src/utils/security.ts
export const sanitizeInput = (input: string): string => {
  return input
    .trim()
    .replace(/[<>]/g, '') // ê¸°ë³¸ XSS ë°©ì§€
    .slice(0, 255); // ê¸¸ì´ ì œí•œ
};

export const validateUrl = (url: string): boolean => {
  try {
    const parsed = new URL(url);
    return ['http:', 'https:'].includes(parsed.protocol);
  } catch {
    return false;
  }
};
```

---

## 8. ì„±ëŠ¥ ìµœì í™”

### 8.1 í”„ë¡ íŠ¸ì—”ë“œ ìµœì í™”

| ê¸°ë²• | êµ¬í˜„ ë°©ë²• |
|------|----------|
| **Code Splitting** | React.lazy() + Suspense |
| **Image Optimization** | WebP í¬ë§· + lazy loading |
| **Bundle Size** | Tree shaking + ì²­í¬ ë¶„ë¦¬ |
| **Caching** | Service Worker + Cache-Control |
| **CSS ìµœì í™”** | PurgeCSS + Critical CSS |

### 8.2 ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

```sql
-- ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_subscriptions_user_id ON subscriptions(user_id);
CREATE INDEX idx_subscriptions_payment_day ON subscriptions(payment_day);
CREATE INDEX idx_alarms_subscription_id ON subscription_alarms(subscription_id);

-- ë·° ìƒì„± (ë³µì¡í•œ ì¿¼ë¦¬ ìµœì í™”)
CREATE VIEW user_subscription_summary AS
SELECT 
  u.id as user_id,
  COUNT(s.id) as total_subscriptions,
  SUM(CASE WHEN s.currency = 'KRW' THEN s.amount ELSE 0 END) as total_krw,
  SUM(CASE WHEN s.currency = 'USD' THEN s.amount ELSE 0 END) as total_usd
FROM auth.users u
LEFT JOIN subscriptions s ON u.id = s.user_id
WHERE s.status = 'active'
GROUP BY u.id;
```

---

## 9. ê°œë°œ ì›Œí¬í”Œë¡œìš°

### 9.1 ë¸Œëœì¹˜ ì „ëµ

```bash
main
â”œâ”€â”€ develop
â”‚   â”œâ”€â”€ feature/subscription-crud
â”‚   â”œâ”€â”€ feature/calendar-view
â”‚   â””â”€â”€ feature/dashboard-stats
â”œâ”€â”€ hotfix/critical-bug
â””â”€â”€ release/v2.0
```

### 9.2 ê°œë°œ í”„ë¡œì„¸ìŠ¤

1. **ì´ìŠˆ ìƒì„±**: GitHub Issuesì— ì‘ì—… ë‚´ìš© ë“±ë¡
2. **ë¸Œëœì¹˜ ìƒì„±**: `feature/ì´ìŠˆë²ˆí˜¸-ê¸°ëŠ¥ëª…`
3. **ê°œë°œ & í…ŒìŠ¤íŠ¸**: ë¡œì»¬ ê°œë°œ ë° í…ŒìŠ¤íŠ¸
4. **PR ìƒì„±**: develop ë¸Œëœì¹˜ë¡œ Pull Request
5. **ì½”ë“œ ë¦¬ë·°**: íŒ€ì› ë¦¬ë·° ë° ìŠ¹ì¸
6. **ë¨¸ì§€ & ë°°í¬**: develop â†’ main ë¨¸ì§€ í›„ ìë™ ë°°í¬

### 9.3 ê°œë°œ ë„êµ¬ ì„¤ì •

```json
// .vscode/settings.json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "typescript.tsdk": "node_modules/typescript/lib",
  "tailwindCSS.experimental.classRegex": [
    ["cn\\(([^)]*)\\)", "[\"'`]([^\"'`]*).*?[\"'`]"]
  ]
}
```

---

## 10. ëª¨ë‹ˆí„°ë§ & ë¡œê¹…

### 10.1 ì—ëŸ¬ íŠ¸ë˜í‚¹

```typescript
// src/utils/errorTracking.ts
export const logError = (error: Error, context?: Record<string, any>) => {
  console.error('Error:', error);
  
  // í”„ë¡œë•ì…˜ì—ì„œëŠ” ì™¸ë¶€ ì„œë¹„ìŠ¤ë¡œ ì „ì†¡
  if (import.meta.env.PROD) {
    // Sentry, LogRocket ë“± í™œìš© ê°€ëŠ¥
    // sendToErrorService(error, context);
  }
};
```

### 10.2 ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

```typescript
// src/utils/performance.ts
export const measurePerformance = (metricName: string) => {
  if ('performance' in window) {
    performance.mark(`${metricName}-start`);
    
    return () => {
      performance.mark(`${metricName}-end`);
      performance.measure(
        metricName,
        `${metricName}-start`,
        `${metricName}-end`
      );
      
      const measure = performance.getEntriesByName(metricName)[0];
      console.log(`${metricName}: ${measure.duration}ms`);
    };
  }
  return () => {};
};
```

---

*ì´ ê¸°ìˆ  ì•„í‚¤í…ì²˜ëŠ” Moonwave v2.0ì˜ í•µì‹¬ ê¸°ìˆ  êµ¬ì¡°ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì²˜ì™€ ì •ì  ë°°í¬ë¥¼ í†µí•´ ë¹„ìš© íš¨ìœ¨ì ì´ë©´ì„œë„ í™•ì¥ ê°€ëŠ¥í•œ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•©ë‹ˆë‹¤.*
